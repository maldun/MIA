<!DOCTYPE html>
<html>
<head>
    <title>My Page</title>
</head>
<body>
    <h1>Hello, {{ name }}!</h1>
    <video id="video" width="400" autoplay loop src="{{ url_for('static', filename='video.mp4') }}">
        Your browser does not support the video tag.
    </video>
    <input type="text" id="messageInput" placeholder="Type a message...">
    <button id="sendMessage">Send Message</button>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO" crossorigin="anonymous"></script>
    <!--<script src="{{ url_for('static', filename='script.js') }}"></script>-->
    <script>
    // Define the port variable before using it
     let port = 8585; // or any other value you set in your Flask app
     const socketUrl = {{ socket_url | tojson }};
  //const socket = io('ws://127.0.0.1:' + port + '/', {
  const socket = io(socketUrl.url, {
  transport: ['websocket', 'polling'],
  reconnectionDelayMax: 10000,
  reconnectionInterval: 500
  });


document.getElementById('sendMessage').addEventListener('click', () => {
  const message = document.getElementById('messageInput').value;
  socket.emit('message', message);
  document.getElementById('messageInput').value = '';
});

socket.on('connect', () => {
  console.log('Connected to the server');
});

socket.on('disconnect', () => {
  console.log('Disconnected from the server');
});

socket.on('message', (data) => {
  console.log(`Received message: ${data}`);
  if (typeof data === 'string' && data.startsWith('video.mp4')) {
    const newSrc = data;
    document.getElementById('video').src = newSrc;
  }
});
    </script>
</body>
</html
